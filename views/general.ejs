<!doctype html>
<html lang="tr">
    <head>
        <%- include('partials/header') -%>
    </head>
    <body>
        <div class="invoice-box">
            <table cellpadding="0" cellspacing="0">
                <tr class="top">
                    <td colspan="2">
                        <table>
                            <tr>
                                <td class="title"><img src="/logo.png"></td>
                                <td>AKIŞ RAPORU<br><%=start_date%> - <%=end_date%></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr class="information">
                    <td colspan="2">
                        <h1 style="text-align: center; font-size: 25px;">GENEL ÖZET</h1>
                        <p style="text-align: justify !important; font-size: 15px;">
                            <b><%=start_date%></b> – <b><%=end_date%></b> tarihleri arasında <b><%=currentRes.stream.name%></b> adlı akışınızda toplam <b><%=currentResToplam%></b> içerik bulunmuştur.
                            İçeriklerin toplamında bir önceki haftaya göre <%=oran%> mevcuttur.
                            Akışınızla ilgili detaylı grafikler aşağıda yer almaktadır.
                        </p>
                        <h2 style="text-align: center; font-size: 20px;">Zamana Göre Toplam İçerik Sayıları</h2>
                        <canvas id="canvas"></canvas>
                        <script>
                            var lineChartData = {
                                labels: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].key_as_string.split("T")[0] %>',<% } %>],
                                datasets: [{
                                    label: 'Seçilen Aralık',
                                    borderColor: window.chartColors.red,
                                    backgroundColor: window.chartColors.red,
                                    fill: false,
                                    data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>],
                                    yAxisID: 'y-axis-1',
                                }, {
                                    label: 'Önceki Aralık',
                                    borderColor: window.chartColors.blue,
                                    backgroundColor: window.chartColors.blue,
                                    fill: false,
                                    data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>],
                                    yAxisID: 'y-axis-2'
                                }]
                            };
                            window.onload = function() {
                                var ctx = document.getElementById('canvas').getContext('2d');
                                window.myLine = Chart.Line(ctx, {
                                    data: lineChartData,
                                    options: {
                                        responsive: true,
                                        hoverMode: 'index',
                                        stacked: false,
                                        title: {display: false},
                                        scales: {
                                            yAxes: [{
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                id: 'y-axis-1',
                                            }, {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                id: 'y-axis-2',
                                                gridLines: {
                                                    drawOnChartArea: false, // only want the grid lines for one axis to show up
                                                },
                                            }],
                                        }
                                    }
                                });
                            };
                        </script>
                        <h2 style="text-align: center; font-size: 20px;">Kategori Bazlı Dağılım</h2>
                        <canvas id="canvasKategori"></canvas>
                        <script>
                            var barChartData = {
                                labels: ['Haber', 'Twitter', 'İnstagram', 'Video', 'Forum/Blog', 'Web'],
                                datasets: [{
                                    label: 'Kategoriler',
                                    backgroundColor: window.chartColors.red,
                                    stack: 'Stack 0',
                                    data: [
                                            <%=kategoriChartRes.stats.news %>,
                                            <%=kategoriChartRes.stats.twitter %>,
                                            <%=kategoriChartRes.stats.news %>,
                                            <%=kategoriChartRes.stats.video %>,
                                            <%=kategoriChartRes.stats.forumblog %>,
                                            <%=kategoriChartRes.stats.web %>
                                    ]
                                }]
                            };
                            var ctx = document.getElementById('canvasKategori').getContext('2d');
                            window.myBar = new Chart(ctx, {
                                type: 'bar',
                                data: barChartData,
                                options: {
                                    title: {display: false},
                                    tooltips: {mode: 'index',intersect: false},
                                    responsive: true,
                                    scales: {
                                        xAxes: [{stacked: true,}],
                                        yAxes: [{stacked: true}]
                                    }
                                }
                            });
                        </script>
                    </td>
                </tr>
            </table>
            <br>
            <%- include('partials/footer') -%>
        </div>
    </body>
</html>