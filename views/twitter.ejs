<!doctype html>
<html lang="tr">
    <head>
        <%- include('partials/header') -%>
    </head>
    <body>
        <header>
            <div class="container">
                <h1>TWITTER AKIŞ RAPORU</h1>
                <div class="middle">
                    <span><%=start_date%> - <%=end_date%></span>
                    <hr/>
                </div>
                <div class="brand">
                    <div class="logo">
                        <img src="/logo.png" alt="">
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <h1>TWITTER ANALİZİ</h1>
                <div class="text">
                    <p style="text-align: justify !important;">
                        <b><%=start_date%></b> – <b><%=end_date%></b> tarihleri arasında <b><%=currentRes.stream.name%></b> adlı akışınızda toplam <b><%=currentResToplam%></b> içerik bulunmuştur.
                        İçeriklerin toplamında bir önceki haftaya göre <%=oran%> mevcuttur.
                        Twitter analizi ile ilgili detaylı grafikler aşağıda yer almaktadır.
                    </p>
                </div>
                <h3>Zamana Göre Toplam Gönderi Sayıları</h3>
                <div id="timeLineChart" class="chart"></div>

                <h3>Günlük Gönderi Dağılımı</h3>
                <div id="dailyChart" class="chart"></div>
            </div>
        </main>
        <script>
            let options = {
                chart: {
                    type: 'line',
                    height: 420,
                    width: 800,
                    toolbar: {
                        show: false
                    },
                    dataLabels: {
                        enabled: true,
                    }
                },
                series: [{
                    name: 'Seçilen aralık',
                    data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>]
                }, {
                    name: 'Önceki aralık',
                    data: [<% for(var i=0; i < lastWeekRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>]
                }],
                xaxis: {
                    categories: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].key_as_string.split("T")[0] %>',<% } %>]
                },
                colors: colors,
                markers: {
                    size: 5
                }
            }
            let chart = new ApexCharts(document.getElementById('timeLineChart'), options)
            chart.render()
            //Second Chart
            let optionsDaily = {
                chart: {
                    height: 420,
                    width: 800,
                    type: 'bar',
                    toolbar: {
                        show: false
                    },
                    dataLabels: {
                        enabled: true,
                    },
                    parentHeightOffset: -5
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        distributed: false,
                        endingShape: 'flat',
                        columnWidth: '70%',
                        dataLabels: {
                            position: 'top',
                        },
                    },
                },
                dataLabels: {
                    enabled: true,
                    offsetY: -10,
                    formatter: function (val) {
                        return val;
                    },
                    style: {
                        fontSize: '12px',
                        colors: ['#444444']
                    },
                },
                series: [{
                            name: 'Önceki Aralık',
                            data: [<% for(var i=0; i < lastWeekRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>]
                        },{
                            name: 'Seçilen Aralık',
                            data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>]
                        }
                    ],
                xaxis: {
                    categories: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].day %>',<% } %>],
                },
                colors: colors,
            }
            let chartDaily = new ApexCharts(document.getElementById('dailyChart'), optionsDaily);
            chartDaily.render();
        </script>
        <div style="page-break-before: always;"></div>
        <!-- Second Page -->
        <header>
            <div class="container">
                <h1>TWITTER AKIŞ RAPORU</h1>
                <div class="middle">
                    <span><%=start_date%> - <%=end_date%></span>
                    <hr/>
                </div>
                <div class="brand">
                    <div class="logo">
                        <img src="/logo.png" alt="">
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <h3>Popüler Tweetler</h3>
                <div class="grid-container">
                    <% for(var i=0; i < populerTweetsRes.documents.length; i++) { %>
                        <div class="item1">
                            <img src="<%= populerTweetsRes.documents[i].avatar %>" style="width: 10%;float: left; border-radius: 50%;">
                            <div style="text-align: left;font-size: 10px;margin-left: 75px;">
                                <b>@<%= populerTweetsRes.documents[i].username %></b>
                                <br>
                                <%= populerTweetsRes.documents[i].content %>
                                <br><br>
                                <div style="text-align: right;"><%= moment(populerTweetsRes.documents[i].created_at).format('DD.MM.YYYY HH:mm:ss') %></div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </main>
        <br><br>
        <div style="page-break-before: always;"></div>
        <!-- Third Page -->
        <header>
            <div class="container">
                <h1>TWITTER AKIŞ RAPORU</h1>
                <div class="middle">
                    <span><%=start_date%> - <%=end_date%></span>
                    <hr/>
                </div>
                <div class="brand">
                    <div class="logo">
                        <img src="/logo.png" alt="">
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <h3>Cinsiyete Göre Dağılım</h3>
                <div id="Cinsiyetchart" style="margin: 0px 200px 0px !important;"></div><br>
                <script>
                    var optionsCinsiyetchart = {
                        series: [<%=genderKadınRes.count%>, <%=genderErkekRes.count%>],
                        chart: {
                            width: 500,
                            type: 'donut',
                        },
                        labels: ['Kadın', 'Erkek'],
                        colors: colors,
                        responsive: [{
                            breakpoint: 480,
                            options: {
                                chart: {width: 200},
                                legend: {position: 'bottom'}
                            }
                        }],
                    };
                    var Cinsiyetchart = new ApexCharts(document.querySelector("#Cinsiyetchart"), optionsCinsiyetchart);
                    Cinsiyetchart.render();
                </script>
                <h3>Tweetlerin İçerik Türüne Göre Dağılımı</h3><br>
                <div id="tweetChart3" class="chart"></div>
                <script>
                    let optionsTweetChart3 = {
                        chart: {
                            width: 800,
                            height: 420,
                            type: 'bar',
                            toolbar: {show: false},
                            dataLabels: {enabled: true,}
                        },
                        colors: colors,
                        plotOptions: {
                            bar: {
                                columnWidth: '45%',
                                distributed: true,
                                dataLabels: {position: 'top'},
                            }
                        },
                        dataLabels: {
                            enabled: true,
                            offsetY: -10,
                            formatter: function (val, opt) {
                                return opt.w.globals.labels[opt.dataPointIndex] + ":  " + val
                            },
                            style: {
                                fontSize: '12px',
                                colors: colors
                            },
                        },
                        series: [{
                            data: [<%=hakaretRes.stats.total%>, <%=kufurRes.stats.total%>, <%=siddetRes.stats.total%>],
                        }],
                        xaxis: {
                            categories: ['Küfür', 'Hakaret', 'Şiddet'],
                            labels: {
                                style: {
                                    colors: colors,
                                    fontSize: '14px'
                                }
                            }
                        },
                        tooltip: {
                            theme: 'dark',
                            x: {show: true},
                            y: {
                                title: {
                                    formatter: function () {
                                        return ''
                                    }
                                }
                            }
                        }
                    }
                    let chartTweetChart3 = new ApexCharts(document.getElementById('tweetChart3'), optionsTweetChart3);
                    chartTweetChart3.render();
                </script>
            </div>
        </main>
    </body>
</html>