<!doctype html>
<html lang="tr">
    <head>
        <%- include('partials/header') -%>
    </head>
    <body>
        <div class="invoice-box">
            <table cellpadding="0" cellspacing="0">
                <tr class="top">
                    <td colspan="2">
                        <table>
                            <tr>
                                <td class="title"><img src="/logo.png"></td>
                                <td>AKIŞ RAPORU<br><%=start_date%> - <%=end_date%></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr class="information">
                    <td colspan="2">
                        <h1 style="text-align: center; font-size: 25px;">TWITTER ANALİZİ</h1>
                        <p style="text-align: justify !important; font-size: 15px;">
                            <b><%=start_date%></b> – <b><%=end_date%></b> tarihleri arasında <b><%=currentRes.stream.name%></b> adlı akışınızda toplam <b><%=currentResToplam%></b> tweet bulunmuştur.
                            Tweet içeriklerin toplamında bir önceki haftaya göre <%=oran%> mevcuttur.
                            Tweet analizi ile ilgili detaylı grafikler aşağıda yer almaktadır.
                        </p>
                        <h2 style="text-align: center; font-size: 20px;">Zamana Göre Toplam Tweet Sayıları</h2>
                        <canvas id="canvas"></canvas>
                        <script>
                            var lineChartData = {
                                labels: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].key_as_string.split("T")[0] %>',<% } %>],
                                datasets: [{
                                    label: 'Seçilen Aralık',
                                    borderColor: window.chartColors.red,
                                    backgroundColor: window.chartColors.red,
                                    fill: false,
                                    data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>],
                                    yAxisID: 'y-axis-1',
                                }, {
                                    label: 'Önceki Aralık',
                                    borderColor: window.chartColors.blue,
                                    backgroundColor: window.chartColors.blue,
                                    fill: false,
                                    data: [<% for(var i=0; i < lastWeekRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>],
                                    yAxisID: 'y-axis-2'
                                }]
                            };
                            window.onload = function() {
                                var ctx = document.getElementById('canvas').getContext('2d');
                                window.myLine = Chart.Line(ctx, {
                                    data: lineChartData,
                                    options: {
                                        responsive: true,
                                        hoverMode: 'index',
                                        stacked: false,
                                        title: {display: false},
                                        scales: {
                                            yAxes: [{
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                id: 'y-axis-1',
                                            }, {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                id: 'y-axis-2',
                                                gridLines: {drawOnChartArea: false,},
                                            }],
                                        }
                                    }
                                });
                            };
                        </script>
                        <h2 style="text-align: center; font-size: 20px;">Günlük Tweet Dağılımı</h2>
                        <canvas id="canvasKategori"></canvas>
                        <script>
                            var barChartData = {
                                labels: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].day %>',<% } %>],
                                datasets: [{
                                    label: 'Seçilen Aralık',
                                    backgroundColor: window.chartColors.red,
                                    stack: 'Stack 0',
                                    data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>]
                                },{
                                    label: 'Önceki Aralık',
                                    backgroundColor: window.chartColors.blue,
                                    stack: 'Stack 0',
                                    data: [<% for(var i=0; i < lastWeekRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>]
                                }]
                            };
                            var ctx = document.getElementById('canvasKategori').getContext('2d');
                            window.myBar = new Chart(ctx, {
                                type: 'bar',
                                data: barChartData,
                                options: {
                                    title: {display: false},
                                    tooltips: {mode: 'index',intersect: false},
                                    responsive: true,
                                    scales: {
                                        xAxes: [{stacked: true,}],
                                        yAxes: [{stacked: true}]
                                    }
                                }
                            });
                        </script>
                    </td>
                </tr>
            </table>
            <br><br>
            <%- include('partials/footer') -%>
        </div>
        <br><br>
        <!-- Page 2 -->
        <div class="invoice-box">
            <table cellpadding="0" cellspacing="0">
                <tr class="top">
                    <td colspan="2">
                        <table>
                            <tr>
                                <td class="title"><img src="/logo.png"></td>
                                <td>AKIŞ RAPORU<br><%=start_date%> - <%=end_date%></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr class="information">
                    <td colspan="2">
                        <h2 style="text-align: center; font-size: 20px;">Popüler Tweetler</h2>
                        <style>
                            .grid-container {
                                display: grid;
                                grid-template-columns: 50% 49% ;
                                grid-gap: 10px;
                                background-color: #2196F3;
                                padding: 10px;
                            }
                            .grid-container > div {
                                background-color: rgba(255, 255, 255, 0.8);
                                text-align: center;
                                padding: 20px 0;
                                font-size: 30px;
                            }
                        </style>
                        <div class="grid-container">
                            <% for(var i=0; i < populerTweetsRes.documents.length; i++) { %>
                                <div class="item1">
                                    <img src="<%= populerTweetsRes.documents[i].avatar %>" style="width: 15%;float: left;">
                                    <div style="text-align: left;font-size: 10px;margin-left: 75px;">
                                        <b>@<%= populerTweetsRes.documents[i].username %></b>
                                        <br>
                                        <%= populerTweetsRes.documents[i].content %>
                                        <br><br>
                                        <%= populerTweetsRes.documents[i].created_at %>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </td>
                </tr>
            </table>
            <br>
            <%- include('partials/footer') -%>
        </div>
    </body>
</html>