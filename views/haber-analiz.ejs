<!doctype html>
<html lang="tr">
    <head>
        <%- include('partials/header') -%>
    </head>
    <body>
        <header>
            <div class="container">
                <h1>HABER AKIŞ RAPORU</h1>
                <div class="middle">
                    <span><%=start_date%> - <%=end_date%></span>
                    <hr/>
                </div>
                <div class="brand">
                    <div class="logo">
                        <img src="/logo.png" alt="">
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <h1>HABER ANALİZİ</h1>
                <div class="text">
                    <p style="text-align: justify !important;">
                        <b><%=start_date%></b> – <b><%=end_date%></b> tarihleri arasında <b><%=currentRes.stream.name%></b> adlı akışınızda toplam <b><%=currentResToplam%></b> içerik bulunmuştur.
                        İçeriklerin toplamında bir önceki haftaya göre <%=oran%> mevcuttur.
                        HABER analizi ile ilgili detaylı grafikler aşağıda yer almaktadır.
                    </p>
                </div>
                <h3>Zamana Göre Toplam Gönderi Sayıları</h3>
                <div class="chart time-line-chart"></div>

                <h3>Popüler Kaynaklarda Çıkan Haberlerin Adet Bazlı Değişimi</h3>
                <div id="instagram-daily-chart" class="chart" data-values='{&quot;labels&quot;:[&quot;Cumartesi&quot;,&quot;Pazar&quot;,&quot;Pazartesi&quot;,&quot;Sal\u0131&quot;,&quot;\u00c7ar\u015famba&quot;,&quot;Per\u015fembe&quot;,&quot;Cuma&quot;],&quot;values&quot;:[{&quot;name&quot;:&quot;Se\u00e7ilen aral\u0131k&quot;,&quot;data&quot;:[35695,35627,34868,38794,37154,37532,35341]},{&quot;name&quot;:&quot;\u00d6nceki aral\u0131k&quot;,&quot;data&quot;:[37939,41049,39852,40246,40335,38931,35659]}]}'></div>
            </div>
        </main>
    <script>
            $(function () {
                let timeLineChart = document.querySelectorAll('.time-line-chart')
                timeLineChart.forEach(element => {
                    let options = {
                        chart: {
                            type: 'line',
                            height: 420,
                            width: 800,
                            toolbar: {
                                show: false
                            },
                            dataLabels: {
                                enabled: true,
                            },
                            markers: {
                                size: 5,
                                discrete: [{
                                    seriesIndex: 0,
                                    dataPointIndex: 1,
                                    fillColor: "#0A0",
                                    strokeColor: "#FFF",
                                    size: 7
                                }]
                            }
                        },
                        series: [{
                            name: 'Seçilen aralık',
                            data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>],
                            backgroundColor: "#afafaf3d",
                            borderColor: "black",
                            borderWidth: 2
                        }, {
                            name: 'Önceki aralık',
                            data: [<% for(var i=0; i < lastWeekRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>],
                            backgroundColor: "#fff70038",
                            borderColor: ["red"],
                            borderWidth: 2
                        }],
                        xaxis: {
                            categories: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].key_as_string.split("T")[0] %>',<% } %>]
                        },
                        yaxis: {
                            show: true,
                            min: 0,
                            forceNiceScale: true,
                        },
                        colors: ['#df8244', '#4d73be'],
                        markers: {
                            size: 5
                        },
                        legend: {
                            show: true,
                            labels: {
                                useSeriesColors: true
                            }
                        }
                    }
                    let chart = new ApexCharts(element, options)
                    chart.render()
                })
                //Second Chart
                let instagramDailyChart = document.querySelector('#instagram-daily-chart')
                let optionsInstagramDaily = {
                    chart: {
                        height: 420,
                        width: 800,
                        type: 'bar',
                        toolbar: {show: false},
                        dataLabels: {enabled: true},
                        parentHeightOffset: -5
                    },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            distributed: false,
                            endingShape: 'flat',
                            columnWidth: '30%',
                            dataLabels: {
                                position: 'top',
                            },
                        },
                    },
                    dataLabels: {
                        enabled: true,
                        offsetY: -20,
                        formatter: function (val) {
                            return val;
                        },
                        style: {
                            fontSize: '12px',
                            colors: ['#444444']
                        },
                    },
                    series: [{
                                name: 'Önceki Aralık',
                                data: [<%=currentResToplam %>],
                                backgroundColor: "red",
                                borderWidth: 1
                            },{
                                name: 'Seçilen Aralık',
                                data: [<%=lastWeekResTotal %>],
                                backgroundColor: "blue",
                                borderWidth: 1
                            }
                        ],
                    xaxis: {
                        categories: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].day %>',<% } %>],
                    },
                    colors: ['#F47B20', '#005596'],
                }
                let chartInstagramDaily = new ApexCharts(instagramDailyChart, optionsInstagramDaily);
                chartInstagramDaily.render();
            })
        </script>
    </body>
</html>