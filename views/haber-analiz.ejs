<!doctype html>
<html lang="tr">
    <head>
        <style>
            @page {
                size: A4;
            }
            .invoice-box {
                max-width: 800px;
                margin: auto;
                padding: 10px;
                border: 1px solid #eee;
                box-shadow: 0 0 5px rgba(0, 0, 0, .15);
                font-size: 10px;
                font-family: 'Helvetica Neue', 'Helvetica', Helvetica, Arial, sans-serif;
                height: 100%;
            }
            .footer{
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100%;
                text-align: center;
                margin: 0;
                height: 25px;
            }
            body, html{height:calc(100% - 20px);}
            .one {width: 30%;float: left;}
            .two {margin-left: 30%;text-align: right;}
        </style>
        <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
        <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    </head>
    <body>
        <div class="invoice-box">
            <div class="one"><img src="/logo.png"></div>
            <div class="two">AKIŞ RAPORU<br><%=start_date%> - <%=end_date%></div>
            <h1 style="text-align: center; font-size: 25px;">HABER ANALİZİ</h1>
            <p style="text-align: justify !important; font-size: 15px;">
                <b><%=start_date%></b> – <b><%=end_date%></b> tarihleri arasında <b><%=currentRes.stream.name%></b> adlı akışınızda toplam <b><%=currentResToplam%></b> içerik bulunmuştur.
                İçeriklerin toplamında bir önceki haftaya göre <%=oran%> mevcuttur.
                Akışınızla ilgili detaylı grafikler aşağıda yer almaktadır.
            </p>
            <h2 style="text-align: center; font-size: 20px;">Zamana Göre Toplam İçerik Sayıları</h2>
            <canvas id="canvas"></canvas>
            <script>
                var lineChartData = {
                    labels: [<% for(var i=0; i < currentRes.stats.length; i++) { %> '<%= currentRes.stats[i].key_as_string.split("T")[0] %>',<% } %>],
                    datasets: [{
                        label: 'Seçilen Aralık',
                        borderColor: window.chartColors.red,
                        backgroundColor: window.chartColors.red,
                        fill: false,
                        data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= currentRes.stats[i].doc_count %>,<% } %>],
                        yAxisID: 'y-axis-1',
                    }, {
                        label: 'Önceki Aralık',
                        borderColor: window.chartColors.blue,
                        backgroundColor: window.chartColors.blue,
                        fill: false,
                        data: [<% for(var i=0; i < currentRes.stats.length; i++) { %> <%= lastWeekRes.stats[i].doc_count %>,<% } %>],
                        yAxisID: 'y-axis-2'
                    }]
                };
                window.onload = function() {
                    var ctx = document.getElementById('canvas').getContext('2d');
                    window.myLine = Chart.Line(ctx, {
                        data: lineChartData,
                        options: {
                            responsive: true,
                            hoverMode: 'index',
                            stacked: false,
                            title: {display: false},
                            scales: {
                                yAxes: [{
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    id: 'y-axis-1',
                                }, {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    id: 'y-axis-2',
                                    gridLines: {
                                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                                    },
                                }],
                            }
                        }
                    });
                };
            </script>
            <h2 style="text-align: center; font-size: 20px;">Popüler Kaynaklarda Çıkan Haberlerin Adet Bazlı Değişimi</h2>
            <canvas id="canvasKategori"></canvas>
            <script>
                var barChartData = {
                    labels: ['Önceki aralık', 'Seçilen aralık'],
                    datasets: [{
                        label: 'Kategoriler',
                        backgroundColor: window.chartColors.red,
                        stack: 'Stack 0',
                        data: [
                                <%=currentResToplam %>,
                                <%=lastWeekResTotal %>
                        ]
                    }]
                };
                var ctx = document.getElementById('canvasKategori').getContext('2d');
                window.myBar = new Chart(ctx, {
                    type: 'bar',
                    data: barChartData,
                    options: {
                        title: {display: false},
                        tooltips: {mode: 'index',intersect: false},
                        responsive: true,
                        scales: {
                            xAxes: [{stacked: true,}],
                            yAxes: [{stacked: true}]
                        }
                    }
                });
            </script>
            <%- include('partials/footer') -%>
        </div>
    </body>
</html>